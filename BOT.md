# MILESTONE: Library BOT

## Index
1. [Installation Steps](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#install) 
2. [Use Cases](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#usecase) 
	* [Use Case 1](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#usecase1)
	* [Use Case 2](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#usecase2)
	* [Use Case 3](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#usecase3)
2. [Mocking](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#mocking)
3. [Bot Implementation](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#implement)
	* [Bot Platform](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#platform)
	* [Bot Integration](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#integration)
4. [Selenium Testing](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#test)
	* [Use Case 1](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#test1)
	* [Use Case 2](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#test2)
	* [Use Case 3](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#test3)
5. [Task Tracking](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/BOT.md/#track)
6. [Screencast]

## <a name="install"></a> INSTALLATION STEPS:
```
sudo apt-get update
sudo apt-get -y install python3-pip
pip3 install flask
pip3 install mattermostdriver
pip3 install -U PyYAML
pip3 install numpy
pip3 install pandas
pip3 install matplotlib
pip3 install seaborn
pip3 install mockito
```

# PLotBot
* This bot provides users with correct function and libraries from **Seaborn** through sample source code.
* The user can also test the correctness of the plot by visualizing their data input on the plot generated by the bot.
* The types of plots the bot can plot are:
   * Line graph
   * Histogram
   * Scatterplot
   * Box-plot
   * Bar chart with facets

## <a name="usecase"></a> USECASES

Below are **refined** use cases for **PlotBot**

### important!! - please refer to make changes in the end

<a name="usecase1"></a>
```
Use Case 1: Give the user with code snippet for the required type of graph.
1 Preconditions
   User must have mattermost account.
2 Main Flow
  User provides the bot with the type of graph it requires [S1].
  Bot returns the appropriate library packages with a usage [S2].
  Bot asks the user if they need a sample visualization. User responds [S3].
  Bot returns according to the response [S4].
3 Subflows
  [S1] User tells bot the graph type @graph_type. e.g. Histogram
  [S2] Bot returns the entire code snippet.
  [S3] Bot asks for plotting sample code provided. User confirms.
  [S4] Bot returns the sample plot.
4 Alternative Flows
  [E1] Requested graph data not available.
```
<a name="usecase2"></a>
```
Use Case2: Plot the graph for the user with their data.
1 Preconditions
   User must have mattermost account.
   User must give the data in the format required by the bot.
2 Main Flow
   User requests bot to generate a graph of a type for their data [S1].
   Bot will provide a specific data format for the graph to be generated [S2].
   User provides its data in the specified format [S3].
   Bot generates the graph and returns it to the user [S4].
3 Subflows
  [S1] User gives a /plot command with @graph_type.
  [S2] Bot will return a sample data format, e.g. a comma separated list.
  [S3] User provides the data in the requested format.
  [S4] Bot returns the generated graph.
4 Alternative Flows
  [E1] Incorrect data format. Requested data format to be provided
  [E2] Requested graph type not available.
```
<a name="usecase3"></a>
```
Use Case3: Provide user with the ability to view all his plots.
1 Preconditions
   User must have mattermost account.
2 Main Flow
   User requests to provide all his plotted graphs using this bot.
3 Subflows
  [S1] User asks to give all the plotted graphs.
  [S2] Bot will return the file of all user plotted graphs. 
4 Alternative Flows
  [E1] No plots available.
```


### Bot Implementation

#### Bot Platform: 
**AWS instance creation, instance1 mattermost server - Deployable**
We created AWS instance for mattermost server. To make our bot independent of the server location of mattermost, we created another instance for out bot on AWS. Our bot is deployable and only requires **BOTTOKEN** from user after they make an account on MatterMost

#### Bot Integration: 
The bot is integrated in a Flask framework which gets activated on certain trigger-words. 

**Flask Framework**
This python based application was used to make HTTP requests. The outgoing webhooks created on Mattermost were integrated with the responder functions of our basic chatbot.

**Trigger words corresponding to different tasks**

Run Commands:
@plotbot - Activates the PlotBot
sample - Covers usecase 1
plot - Covers usecase 2 
retrieve - Covers usecase3

**Example Usecase**
```
@plotbot Hey!
sample [boxplot/scatterplot/barplot]
plot [scatterplot/boxplot/barplot] "iris.csv(upload file on Matternost)"
retrieve from:05/06/2018 to:08/07/2019 OR can be a particular file name the use wants(say iris.csv)
```

### Puppeteer Testing
To test and automate our BOT, we used Pupeteer Node library for testing responses on headless Chromium. 
In order to run the tests:
* Do ```npm install```
* Export your MATTERMOST_EMAIL and MATTERMOST_PWD
* Do npm test. We add a total of 7 Test Cases covering our use cases.

###### Use Case 0: Basic conversation on @plotbot trigger
```javascript
  it('It should greet back', async () => {
        var list = [,]

        await page.waitForSelector('#post_textbox');
        await page.focus('#post_textbox')
        await page.keyboard.type( "@plotbot hi" );
        await page.keyboard.press('Enter');
        let promise = new Promise((res, rej) => {
          setTimeout(() => res("Waiting for the Response!"), 10000)
        });
        let waiting = await promise;
        await page.waitForSelector('.post__body');
        const output = await page.evaluate(() => Array.from(
          document.getElementsByClassName('post__body'), e => e.innerText));
        var result = output[output.length-1];
        expect(result).to.match(/^Hi*/);

        await browser.close();
    });
 ```
##### Use Case 1: 
##### Use Case 2: 
##### Use Case 3: 

### Mocking Service Component

We implemented mock services for each use case and data to support service integration. 

**Failure to use appropriate mocking/injection techniques will result in 0 credit**. Do not do this:

```javascript
bot.hears("command", function(){ bot.replys("fake answer");});
```

### Screencast

Create a screencast of your bot performing your three primary use cases. Demonstrate your selenium tests being executed.

## Deliverables

Add your code, and BOT.md document describing the following materials.

* Bot Platform Implementation (20%)
* Use Cases Refinement (10%)
* Mocking infrastructure (30%)
* Selenium testing of each use case (30%)
* Screencast (10%)

**Contribution requirements**: Each team member must make contributions on a milestone (e.g., committing code, being assigned and completing tasks). Failure to perform any work will result in no credit for a team member for the milestone.

**Secrets**: Including secrets (passwords, tokens, etc.) in your source code or checked into repository, will result in significant deductions to your grade.

DUE: Tuesday, October 22, before midnight.
