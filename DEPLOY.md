# Milestone: DEPLOYMENT

In the previous milestone, we implemented the services required for your use cases and implemented interaction with a bot. In this milestone, you will be demonstrating a fully deployed version of your bot for use in a Mattermost environment.


## Deployment

Using a configuring management tool, you must fully provision and configure a remote environment for your bot. You should largely be able to reuse homework materials but adopted for your bot.

### Deployment steps
#### Pre-requisites
`sudo apt update`</br>
`sudo apt install -y python3`</br>
`sudo apt install -y python3-pip`</br>
`sudo apt install -y ansible`</br>
`pip3 install ansible`</br>

#### Ansible playbook
`sudo ansible-playbook -i inventory provision.yaml --ask-vault-pass`

In your README.md, document how these configuration management tools and deployment scripts should be run and make sure to include demonstrate running them in your screencast.

## Acceptance Testing

For your DevBots, create a test team and a TA user account, which TAs will be using for testing your deployed bot. For github bots, grant the necessary permissions for performing tasks on a demo repository. 

Provide **login credentials** for TA.

### 1. To initiate converstion with plotbot
  1. Log-in to [mattermost client](http://ec2-18-217-150-234.us-east-2.compute.amazonaws.com:8065).
  2. Enter the username as **evaluator** and password as **evaluator**.
  3. After successfully logging in, navigate to "evaluation" channel and execute the testcases given in the acceptance test plan below. 

### 2.Three usecases to be tested. <br>

**Usecase 1: Give the user with code snippet for reuired type of graph**
In the first use case, the user can request to provide sample of code snippet and a sample of plot for a particular plot type. 

```
Usage: 
sample <plot-type>
```
```
Note: 
The trigger word 'sample' has to be in lowercase only.
plot-type supported : scatterplot, boxplot and barplot
```

1. The user requests for a sample of scatterplot
```sh
Input:
sample scatterplot
```
`Expected output`: 

<img width="420" src="https://media.github.ncsu.edu/user/13071/files/0481f480-1392-11ea-9c43-d0537c2665da">

2. The user requests for a sample of barplot
```sh
Input:
sample barplot
```
`Expected output`: 

<img width="447"  src="https://media.github.ncsu.edu/user/13071/files/fbae1480-13cb-11ea-9453-e7e4ee924a7d">

3. The user requests for a sample of boxplot
```sh
Input:
sample boxplot
```
`Expected output`: 

<img width="450" src="https://media.github.ncsu.edu/user/13071/files/ea650800-13cb-11ea-89d5-66b9520c4e3e">

4. When user requests for a plot which is not supported (example countplot)
```sh
Input:
sample countplot
```
```sh
Expected output:
Requested plot sample not available
```
**Usecase 2: Plot the graph for the user with their custom data.**
In this use case, the user can request for a plot to be generated by either uploading the dataset or using the pre uplodaed datasets and providing the axis information (i.e. X axis and Y axis labels). The bot reponds with the plot generated.
```
Usage: 
Text: plot <plot-type> <dataset-name> <x-axis_label> <y-axis_label>
Attached file: CSV of dataset
```
```
Note the following:
1. x-axis and y-axis labels are column names in the dataset, so they should match.
2. The plot-type supports only for 'scatterplot', 'boxplot' and 'barplot'.
3. You can download the test datasets from location given below.
4. The trigger word 'plot' has to be in lowercase only.
5. For scatterplot and barplot there has to be <x-axis_label> <y-axis_label> mandatorily.
6. For boxplot input of <x-axis_label> only will result in running a outlier analysis on that column.
```
Test Datasets: 
[petals](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/plotbot/puppeteer/test/dataset.csv) Column names : 
[weather](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/plotbot/puppeteer/test/weather.csv)

1. The user requests to plot barplot by uploading dataset
`Input:`

<img width="397" src="https://media.github.ncsu.edu/user/13071/files/d4eede80-13c9-11ea-8522-af0a64275b67">

`Expected Output:`

<img width="530" src="https://media.github.ncsu.edu/user/13071/files/d7513880-13c9-11ea-863b-fbdd5dcfe549">

2. The user requests to plot boxplot, with the dataset already uploaded with outlier analysis on any one column (x-axis-label)
```
Input:
plot boxplot weather x1
```

`Expected Output:`

<img width="526" src="https://media.github.ncsu.edu/user/13071/files/24cca600-13c8-11ea-88b7-ce93b2be4ffe">

3. The user requests to plot boxplot, with the dataset already uploaded with outlier analysis with X and Y axis information
```
Input:
plot boxplot dataset sepal.length sepal.width
```

`Expected Output:`

<img width="509" src="https://media.github.ncsu.edu/user/13071/files/454a2f80-13cb-11ea-8099-218e08284992">

4. The user requests to plot scatterplot with existing dataset with 1 input variable (x-axis-label) and 1 output variable (y-axis-label)
```
Input:
plot scatterplot weather x1 y
```

`Expected Output:`

<img width="516" src="https://media.github.ncsu.edu/user/13071/files/9b1dd800-13c9-11ea-8616-b3018114c714">

5. The user requests to plot barplot mentioning a dataset which was not previously uploaded.

```
Input:
plot barplot iris month y
```

```
Expected Output:
Please request by uploading the dataset. The mentioned dataset doesn't exist in our database.
```

**Usecase 3: Provide user the ability to retrieve their plots.**
In this usecase, the user has the ability to retrieve his previous plot(s), either fetching one by one by giving the specific plot-ID or they can get all their previous graphs or graphs which were plotted  between a timestamp to other timestamp.

```
Usage:
retrieve <plotID.png>
retrieve all
retrieve from:<start_time> to:<stop_time>
```

```
Note:
<start_time> and <stop_time> should be of format : Y-m-d H:M:S.f' or 'Y-m-d'
When giving only date and not time, the time is considered as 0:0:0.0 of that day
When more than 5 files are to be sent by the bot, they would be put in a zip and returned.
All timestamps should be in UTC.
```

1. User requests to retrieve all his plots (gets indivisual file because number of returned plots <= 5).

```
Input:
retrieve all
```

`Expected Output:`

<img width="435" src="https://media.github.ncsu.edu/user/13071/files/35801a80-13ce-11ea-9c12-610ee13c3b72">

2. User requests to retrieve a particular plot using the plot-ID.

```
Input:
retrieve hpzwecnhip.png
```

`Expected Output:`

<img width="550" src="https://media.github.ncsu.edu/user/13071/files/affd6a00-13cf-11ea-9dec-33724e2d96e8">

3. User requests to retrieve plots from a timestamp to a timestamp (gets zipped file containing all plots during the time range becuase number of returned plots > 5).

```
Input:
retrieve from:2019-11-19 13:0:0.0 to:2019-12-30 14:0:0.0
```

`Expected Output:`

<img width="419" src="https://media.github.ncsu.edu/user/13071/files/c22ad880-13ce-11ea-9ee8-02c7f5ce633b">


4. User requests plot(s), but no plots were generated till date.

```
Input:
retrieve abc.png
```

```
Expected Output:
No plots available
```

## Final code Structure

<img src= https://media.github.ncsu.edu/user/13071/files/08853500-13d9-11ea-9bc4-c9bdff19ffa9>

### Bonus: Continuous Integration (CI) Server
We are running Jenkins server on hosted VM.
We have enabled git polling for every 2 minutes. For every build, a new instance for testing gets created with the latest code from github and integration tests will run on that instance. When all the integration tests pass, the BUILD will be SUCCESS.
For every build, [this](https://github.ncsu.edu/csc510-fall2019/CSC510-22/blob/master/jenkins-script.sh) shell script will be executed.

Screencast: The screencast of the Jenkins server running a build job can be found [here]()


### Submit

In your repository, create a new markdown file, DEPLOY.md, with descriptions about the following:

* Deployment scripts
* Acceptance tests
* Final code
* Optional bonus: Code and screencast for continuous integration server.

Due Sunday, December 1st, before midnight.

### Evaluation

* Deployment scripts and screencast (25%)
* Acceptance testing (40%)
* Exploratory Testing and Code Inspection (30%)
* Bonus: Continuous Integration Service (20%)
